<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700&display=swap" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700&display=swap" rel="stylesheet"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/air-datepicker/2.2.3/css/datepicker.css" rel="stylesheet">
    <link href="https://maxcdn.icons8.com/fonts/line-awesome/1.1/css/line-awesome-font-awesome.min.css" rel="stylesheet">
    
   
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>


    <link href="assets/css/profile.css"  rel="stylesheet">
    <link href="assets/css/profile2.css"  rel="stylesheet">
    

    <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <!-- <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet"> -->

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- VueJs -->
  <script src="https://unpkg.com/vue@next"></script>
    <style>
      body {
  font-family: 'Quicksand', sans-serif;
  color: #324e63;
  background: url(assets/img/wallpaper.jpg) no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover; 
  
}
    </style>
</head>
<body>
  <div id='navHead'>
    <navhead index='nav-link scrollto' about='nav-link scrollto' tracker='nav-link scrollto active' team='nav-link scrollto' contact='nav-link scrollto'></navhead>
  </div> 





  <div class="wrapper">
    <div class="profile-card js-profile-card">
      
      <!-- <div class="profile-card__img">
        <img src="./data/downloadss.jpg" alt="profile card">
      </div> -->
  
      <div class="profile-card__cnt js-profile-cnt">
        <a href="profiling.php" class="btn btn-primary" style="float: right;position: absolute;right: 0;margin-right: 10px;">Update</a>
        <H2 style="margin-top: 50px;">Welcome! </H2>
        
        <div class="profile-card__name" id="username"></div>
        
     
  
        <div class="profile-card-inf">
          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "Height"></div>
            <div class="profile-card-inf__txt">Height</div>
          </div>

          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "Weight"></div>
            <div class="profile-card-inf__txt">Weight</div>
          </div>
        </div>
       <br>
        <div class="profile-card__txt">This is your Monthly Nultrition Count:</div>

        <div class="profile-card-inf">
          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "TotalCaloriesBurned"></div>
            <div class="profile-card-inf__txt">Calories Burnt</div>
          </div>
  
          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "TotalCalories"></div>
            <div class="profile-card-inf__txt" >Calories</div>
          </div>
  
          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "TotalProtein"></div>
            <div class="profile-card-inf__txt">Protein</div>
          </div>
  
          <div class="profile-card-inf__item">
            <div class="profile-card-inf__title" id= "TotalCarb"></div>
            <div class="profile-card-inf__txt">Carbohydrate</div>
          </div>
        </div>
  
<!-------------------------- Start of Chart -------------------------------------------->
    

<div class="p-5">
  <h2 class="mb-4">Full Calendar</h2>
  <div class="card">
    <div class="card-body p-0">
      <div id="calendar"></div>
    </div>
  </div>
</div>


 
  <canvas id="myChart" width="400" height="200"></canvas> <br><br>


  <label for="nutrition analysis">Choose an analysis:</label>
  <select name="nutrition" onchange="piechart(this.value)" id="analysis">
    <option value="calories" selected>Calories</option>
    <option value="protein">Protein</option>
    <option value="carbs">Carbohydrate</option>
    
  </select>
  <canvas id="oilChart" width="600" height="400"></canvas>
  <canvas id="oilChart1"  width="600" height="400"></canvas>
  <canvas id="oilChart2"  width="600" height="400"></canvas>
    
<!-------------------------- End Of Chart ---------------------------------------------->


<input type="hidden" id="recoCal">
<input type="hidden" id="recoCarbs">
<input type="hidden" id="recoProt">








<!--------------------------Start of calender-------------------------------------------->

  
<div class="btn btn-danger" onclick="logout()">logout</div>
  <!-- <div class="form-group">
    <strong>How are you feeling today: </strong>
    <span v-if="rating == 1">‚òπÔ∏èBad.</span>
    <span v-else-if="rating == 2">üòêNot good.</span>
    <span v-else-if="rating == 3">üôÇOk</span>
    <span v-else-if="rating == 4">üòÑGood</span>
    <span v-else>üòçGreat!</span>  <br>
    <input type="range" min=1 max=5 v-model="rating">
 </div>  -->


  <!------------------------- calendar modal ---------------------------------------------->
  
  
  <div id="app1">
    <calenderdiv></calenderdiv>
</div>

  <!-----------------------------------------------------End Of calender------------------------------------------------------------------------->





  



    <script>

//   $.ajax({
//     type: "POST",
//     dataType: "json",
//     url: "https://api.foodai.org/v4.1/classify",
//     crossDomain: true,
//     headers:{
//       "Access-Control-Allow-Origin": "*"
//     },
//     data: {
//       image_url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQIpeyTr_Ao9ClVVsewKytiTjBxnxvpUqJ0hA&usqp=CAU",
//       num_tag: 5,
// api_key:"03123fb19ceaba0f1a7c658a23fb610af005c2a0"
//     },
//     success: function(respones){
//       console.log(respones)
//     },
//     error: function(error){
//       console.log(error)
//     }
//   });

////////////////////////////////Calender///////////////////////////////////////////

var username = localStorage.getItem("username");
    if (username === null){
      window.location.href = "login/loginpage.php";
    }
  

function logout() {
  localStorage.removeItem('username')  
  
  window.location.href = "login/logout.php";
}

  



const app1 = Vue.createApp({
 
});


app1.component("calenderdiv",{
// props:[foodname],
data() {
    return{
    rating: 1,
    foodname: "",
    answer: "",
    Carbohydrates: "",
    Protein:"",
    Calories:"",
    tog: true


  }
  },
  watch: {
    // whenever question changes, this function will run
    foodname: function (newQuestion, oldQuestion) {
      this.debouncedGetAnswer()
    }
  },
  created: function () {

    
    this.debouncedGetAnswer = _.debounce(this.getAnswer, 900)
  },

  methods: {
    getAnswer: function () {
     console.log(document.getElementById("name").value)
     
     $.ajax({
        type: "GET",
        dataType: "json",
        url: "https://api.edamam.com/api/recipes/v2?type=public&q="+ this.foodname +"&app_id=01b3b5d9&app_key=388ac25dc41e876768b68fa8fa57df91&",
        crossDomain: false,
        success: function(response) {
          console.log(response)
          if (response.hits.length == 0){
            localStorage.setItem('Carbohydrates', " ");
          localStorage.setItem('Calories', "  " )
          localStorage.setItem('Protein', "  ")
          document.getElementById("result") = "<div class='text-danger'>Food cant be detected, please key in calories yourself</div>"
          }
          else{
          localStorage.setItem('Carbohydrates', response.hits[0].recipe.totalNutrients.CHOCDF.quantity);
          localStorage.setItem('Calories', response.hits[0].recipe.totalNutrients.ENERC_KCAL.quantity )
          localStorage.setItem('Protein', +response.hits[0].recipe.totalNutrients.PROCNT.quantity)
          }

         
        },

        error : function(xhr, status, error)
        {
          console.log("Status of error message" + status + "Error is" + error);
        }     
    }); 
              this.Carbohydrates = localStorage.getItem('Carbohydrates');
              this.Calories = localStorage.getItem('Calories');
              this.Protein = localStorage.getItem('Protein');
        },
    capture: function(){
},

    toggle: function(){
     
      
    },



  },
template: `
<div  id="modal-view-event" class="modal modal-top fade calendar-modal">
          <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                  <div class="modal-body">
                      <h4 class="modal-title"><span class="event-icon"></span><span class="event-title"></span></h4>
                      <div class="event-body"></div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                  </div>
              </div>
          </div>
      </div>
  <div id="modal-view-event-add" class="modal modal-top fade calendar-modal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form id="add-event">
          <div class="modal-body">
          <h4>Add Food Details</h4>      
            <div class="form-group">
              <label>Food Name</label>
              <input type="text" class="form-control" v-model="foodname" value={{answer}}  id="name" name="ename">
            </div>
            <div class="btn btn-primary" id="oncam" >Image Recognition</div>
            
            <div id="cam" style="display:none;"> 
              <video width=320 height=240 id="player" controls autoplay ref="input"></video><br>
              <div class="btn btn-primary"  id="capture"  >Capture</div>
              <div class="btn btn-primary"  id="closecam"  >Close</div>
              <canvas id="canvas" width=320 height=240></canvas> <br>
              Results: <div class="container"><div id="result" class="row"></div></div>
            </div>  
           
            <div class="form-group">
              <label>Event Date</label>
              <input type='text' class="datetimepicker form-control" name="edate">
            </div> 



            <div class="form-group">
              <label>Calories (kcal)</label>
              <textarea class="form-control" :value="Calories" id="Calories" name="Calories"></textarea>
            </div>
            <div class="form-group">
              <label>Protein (g)</label>
              <textarea class="form-control" :value="Protein" id="Protein" name="Protein"></textarea>
            </div>            
            <div class="form-group">
              <label>Carbohydrates (g)</label>
              <textarea class="form-control" :value="Carbohydrates" id="Carbohydrates" name="Carbohydrates"></textarea>
            </div>

            <div class="form-group" style="display:none;">
              <label>Event Color</label>
              <select class="form-control" name="ecolor">
                <option value="fc-bg-default">fc-bg-default</option>
                <option value="fc-bg-blue">fc-bg-blue</option>
                <option value="fc-bg-lightgreen">fc-bg-lightgreen</option>
                <option value="fc-bg-pinkred">fc-bg-pinkred</option>
                <option value="fc-bg-deepskyblue">fc-bg-deepskyblue</option>
              </select>
            </div>
            <div class="form-group"  style="display:none;">
              <label>Event Icon</label>
              <select class="form-control" name="eicon">
                <option value="circle">circle</option>
                <option value="cog">cog</option>
                <option value="group">group</option>
                <option value="suitcase">suitcase</option>
                <option value="calendar">calendar</option>
              </select>
            </div>  
        </div>
          <div class="modal-footer">
          <button type="submit" class="btn btn-primary" >Save</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>        
          </div>
        </form>
      </div>
    </div>
  </div>
  

  `
})
app1.mount('#app1')



$("#closecam").click(function(){
  $("#cam").fadeOut();
  player.srcObject.getVideoTracks().forEach(track => track.stop());
});



$("#oncam").click(function(){
  
  $("#cam").fadeIn();

          const player = document.getElementById('player');
          const canvas = document.getElementById('canvas');
          const context = canvas.getContext('2d');
          const captureButton = document.getElementById('capture');


            const constraints = {
            video: true,
          };

          navigator.mediaDevices.getUserMedia(constraints)
            .then((stream) => {
              player.srcObject = stream;
            });


          captureButton.addEventListener('click', () => {
            // Draw the video frame to the canvas.
            context.drawImage(player, 0, 0, canvas.width, canvas.height);
            console.log(canvas)
            var Pic = canvas.toDataURL("image/png");
            //Pic = Pic.replace(/^data:image\/(png|jpg);base64,/, "")
          $.ajax({
          type: "POST",
          dataType: "json",
          url: "https://api.foodai.org/v4.1/classify",
          crossDomain: true,
          data: {
            image_url: Pic,
            num_tag: 5,
            api_key:"62f40985765435783d123372c0bd5dc29a4b5da0"
          },
          success: function(respones){
            console.log(respones)
            console.log(respones.food_results[0][0])
            if (respones.food_results[0][0] == "Non Food"){
              document.getElementById("result").innerHTML =  "<div class='text-danger'>Please capture a proper food leh</div>"
            }
            else{
              document.getElementById("result").innerHTML= ""
              for (i in respones.food_results){
              document.getElementById("result").innerHTML += "<div class='col-6 results' style='border-style: groove;display:inline-block;color:#444;border:1px solid #CCC;background:#DDD;box-shadow: 0 0 5px -1px rgba(0,0,0,0.2);cursor:pointer;vertical-align:middle; max-width: 100px;padding: 5px;text-align: center;'>"+ respones.food_results[i][0] +"</div>"
            }
            }
            
           
            $('.results').click(function() {
              var text = $(this).text();
              console.log(text)
              // do something with the text
              document.getElementById("name").value = text

              $.ajax({
        type: "GET",
        dataType: "json",
        url: "https://api.edamam.com/api/recipes/v2?type=public&q="+ text +"&app_id=01b3b5d9&app_key=388ac25dc41e876768b68fa8fa57df91",
        crossDomain: false,
        success: function(response) {
          console.log(response)
          if (response.hit.length == 0){
            document.getElementById("Carbohydrates").value = ""
            document.getElementById("Calories").value =""
          document.getElementById("Protein").value = ""
          }
          else{
            document.getElementById("Carbohydrates").value = response.hits[0].recipe.totalNutrients.CHOCDF.quantity;
          document.getElementById("Calories").value = response.hits[0].recipe.totalNutrients.ENERC_KCAL.quantity 
          document.getElementById("Protein").value = response.hits[0].recipe.totalNutrients.PROCNT.quantity
          }
          
        },

        error : function(xhr, status, error)
        {
          console.log("Status of error message" + status + "Error is" + error);
        }     
    }); 
            });                     
          },
          error: function(error){
            console.log(error)
          }
          });

          });
   });       






// const app = Vue.createApp({
//   data() {
//     return{
//     rating: 1
//   }
    
//   }
// });
// app.mount('#app')




// app.component('navhead', {
//   props: ['index', 'about', 'tracker', 'team', 'contact'],
      
//   template: `
//       <header id="header" class="d-flex align-items-center">
//           <div class="container d-flex align-items-center">

//           <h1 class="logo me-auto"><a href="index.html">HealthYou</a></h1>        
//           <nav id="navbar" class="navbar">
//               <ul>
//                   <li><a :class="index" href="index.html#hero">Home</a></li>
//                   <li><a :class="about" href="index.html#about">About</a></li>
//                   <li class="dropdown"><a :class="tracker"  href="#services"><span>Calories Tracker</span> <i class="bi bi-chevron-down"></i></a>
//                       <ul>
//                       <li><a href="home.html">Food Calorie Tracker</a></li>
//                       <li><a href="profile.html">Calendar</a></li>
//                       <li><a href="anotherplace.html">Walking Distance Tracker</a></li>
//                       </ul>
//                   </li>
//                   <li><a :class="team" href="index.html#team">Team</a></li>
//                   <li><a :class="contact" href="index.html#contact">Contact</a></li>
//               </ul>
//               <i class="bi bi-list mobile-nav-toggle"></i>
//           </nav>

//           </div>
//       </header>
//       `      
// } ).mount('#navHead')
// //app.mount('#navHead')

// app.component("calenderdiv",{

// })





///////////////////////////////Insert Calender///////////////////////////////////////


var username = localStorage.getItem("username");
document.getElementById("username").innerHTML = username

jQuery(document).ready(function(){
  jQuery('.datetimepicker').datepicker({
    dateFormat: 'yyyy-mm-dd',
      timepicker: true,
      language: 'en',
      range: true,
      multipleDates: true,
		  multipleDatesSeparator: " - "
      
    });
  jQuery("#add-event").submit(function(){
      alert("Submitted");
      // event.preventDefault();
      var values = {};
      $.each($('#add-event').serializeArray(), function(i, field) {
          values[field.name] = field.value;
      });
      var date = values.edate
      var date1 = date.substring(0, date.length-3);

      axios.get("server/insertcalender.php",
      {params:{
        username: username,
        className :"fc-bg-default",
        starts:date1,
        ends: date1,
        descriptions: {"Calories":values.Calories, "Protein":values.Protein, "Carbohydrates":values.Carbohydrates},
        icon: "circle",
        title: values.ename
      }}).then(response=>{
        console.log(response.data)
      }).catch(error=>{
        alert(error)
      })
      
      console.log(
        values
      );
  });
});

///////////////////////////////End Insert Calender///////////////////////////////////////




///////////////////////////////Get Calender///////////////////////////////////////


var username = localStorage.getItem("username");

(function () {    
    'use strict';
    // ------------------------------------------------------- //
    // Calendar
    // ------------------------------------------------------ //
    $.ajax({
    url:"server/getcalender.php",
    data: {
        "username": username
    },
    type:"POST",
    crossDomain:true,
    
    success:function(msg){
        //id_numbers = msg;
        // id_numbers = JSON.parse(msg);
        console.log(msg)
        var TotalCalories = 0
        var TotalProtein = 0
        var TotalCarb = 0

        // for (let i = 0; i < msg.length; i++){
        //   var eachNultrition = JSON.parse(msg[i].description)
        //   TotalCalories += parseFloat(eachNultrition.Calories)
        //   TotalProtein += parseFloat(eachNultrition.Protein)
        //   TotalCarb += parseFloat(eachNultrition.Carbohydrates)

        // }
        // document.getElementById("TotalCalories").innerHTML = TotalCalories.toFixed(0)
        // document.getElementById("TotalProtein").innerHTML = TotalProtein.toFixed(0)
        // document.getElementById("TotalCarb").innerHTML = TotalCarb.toFixed(0)
        var event =  msg
  
        jQuery(function() {
		// page is ready
		jQuery('#calendar').fullCalendar({
			themeSystem: 'bootstrap4',
			// emphasizes business hours
			businessHours: false,
			defaultView: 'month',
			// event dragging & resizing
			editable: true,
			// header
			header: {
				left: 'title',
				center: 'month,agendaWeek,agendaDay',
				right: 'today prev,next'
			},
			events:event,
			eventRender: function(event, element) {
				if(event.icon){
					element.find(".fc-title").prepend("<i class='fa fa-"+event.icon+"'></i>");
				}
			  },
			dayClick: function(info) {
				jQuery('#modal-view-event-add').modal();
        
			},
			eventClick: function(event, jsEvent, view) {
        console.log(JSON.parse(event.description))
        console.log(view.start._d)
        var details = JSON.parse(event.description)
			    jQuery('.event-icon').html("<i class='fa fa-"+event.icon+"'></i>");
					jQuery('.event-title').html(event.title);
					jQuery('.event-body').html("Calories: "+details.Calories+"<br>Protein: " + details.Protein +"<br>Carbohydrates:"+ details.Carbohydrates );
					jQuery('.eventUrl').attr('href',event.url);
          jQuery('.modal-footer').html(`                    
                    <form action="server/deleteFoodRecord.php" method="post">
                      <input type="hidden" style="display:none;" name="username" value="${username}">
                      <input type="hidden" style="display:none;" name="foodName" value="${event.title}">
                      <input type="hidden" style="display:none;" name="timing" value="${event.start._i}">

                      <input type="submit"  type="button" onclick="alert('Food record has been deleted')" class="btn btn-primary" value="Delete food record">
                    </form>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>`);
					jQuery('#modal-view-event').modal();
			},
      
		})
	});

    },
    dataType:"json"
});
})(jQuery);
///////////////////////////////End Calender///////////////////////////////////////





////////////////////////////Get user details//////////////////////////////////////

$.ajax({
    url:"server/getUserDetail.php",
    data: {
        "username": username,
    },
    type:"POST",
    crossDomain:true,
    
    success:function(msg){
  
        msg = JSON.parse(msg)
        console.log(msg)
        document.getElementById("Height").innerHTML = msg[0].height
        document.getElementById("Weight").innerHTML = msg[0].weight

        document.getElementById("recoCal").value = msg[0].recoCal
        document.getElementById("recoCarbs").value = msg[0].recoCarbs
        document.getElementById("recoProt").value = msg[0].recoProt
        console.log( document.getElementById("recoCarbs").value)
        // for (var i = 0; i < msg.length; i++){
        //   var eachNultrition = JSON.parse(msg[i].description)
        //   TotalCalories += parseFloat(eachNultrition.Calories)
        //   TotalProtein += parseFloat(eachNultrition.Protein)
        //   TotalCarb += parseFloat(eachNultrition.Carbohydrates)
        
        //      }     
        // document.getElementById("TotalCalories").innerHTML = TotalCalories.toFixed(0)
        // document.getElementById("TotalProtein").innerHTML = TotalProtein.toFixed(0)
        // document.getElementById("TotalCarb").innerHTML = TotalCarb.toFixed(0)
      
    }

  });


//////////////////////////End Get user Details/////////////////////////////////////////





///////////////////////////////Get Nultrition///////////////////////////////////////




var username = localStorage.getItem("username");
const today = new Date()
var year = today.getFullYear()
var date = today.getMonth() +1
console.log(date)
$.ajax({
    url:"server/getnultrition.php",
    data: {
        "username": username,
        "date": date,
        "year": year
    },
    type:"POST",
    crossDomain:true,
    
    success:function(msg){
      var TotalCalories = 0
        var TotalProtein = 0
        var TotalCarb = 0
  
        msg = JSON.parse(msg)

        for (var i = 0; i < msg.length; i++){
          var eachNultrition = JSON.parse(msg[i].description)
          TotalCalories += parseFloat(eachNultrition.Calories)
          TotalProtein += parseFloat(eachNultrition.Protein)
          TotalCarb += parseFloat(eachNultrition.Carbohydrates)
        
             }     
        document.getElementById("TotalCalories").innerHTML = TotalCalories.toFixed(0)
        document.getElementById("TotalProtein").innerHTML = TotalProtein.toFixed(0)
        document.getElementById("TotalCarb").innerHTML = TotalCarb.toFixed(0)
      
    }

  });






  $.ajax({
           url:"server/getCaloriesBurn.php",
            data: {
                  "username": username,
                  "date": date,
                  "year": year
                    },            
            type:"POST",
            crossDomain:true,
                        
                success:function(response){
                  var CalBurn = 0
                  response = JSON.parse(response)
                  console.log(response[0].caloriesBurned)
                  for (let i = 0; i < response.length; i++){
         // var eachNultrition = JSON.parse(response[i].caloriesBurned)
                  CalBurn += parseFloat(response[i].caloriesBurned)
          
                  }
                document.getElementById("TotalCaloriesBurned").innerHTML = CalBurn.toFixed(0)
                      }
                      })             


///////////////////////////////////Get Nultrition//////////////////////////////////////////


///////////////////////////////////Chart JS//////////////////////////////////////////
 



var username = localStorage.getItem("username");
const today2 = new Date()
//var date = today2.getMonth() +1
var year = today2.getFullYear()
console.log(year)
var Protein1 = [];
var Carbohydrates1 = [];
//var num = 0;
      for (let q = 1; q <= 12; q++){  
          
        var TotalProtein = 0
        var TotalCarb = 0
                $.ajax({
                    url:"server/getnultrition.php",
                    data: {
                        "username": username,
                        "date": q,
                        "year": year
                    },
                    type:"POST",
                    crossDomain:true,
                    success:function(msg){ 
                       
                        msg = JSON.parse(msg)   
                       console.log(msg)
                        
                        if (msg.length == 0){
                          Protein1[q-1] = 0
                          Carbohydrates1[q-1] = 0
                        }
                        else{
                          TotalProtein = 0
                          TotalCarb = 0
                          for (let i = 0; i < msg.length; i++){
                                var eachNultrition = JSON.parse(msg[i].description)
                                //TotalCalories += parseFloat(eachNultrition.Calories)
                                TotalProtein += parseFloat(eachNultrition.Protein)
                                TotalCarb += parseFloat(eachNultrition.Carbohydrates)
                                }
                                Protein1[q-1] = TotalProtein
                                Carbohydrates1[q-1] = TotalCarb
                        
                            // console.log(Protein)
                            // console.log(Carbohydrates)

                        }
                        
                        

var ctx = document.getElementById("myChart");
var chart = new Chart(ctx, {
  type: "bar",
  data: {
    labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC" ],
    datasets: [
      {
        type: "bar",
        backgroundColor: "rgba(54, 162, 235, 0.2)",
        borderColor: "rgba(54, 162, 235, 1)",
        borderWidth: 1,
        label: "Protein",
        data: Protein1
      },

      {
        type: "bar",
        label: "Carbohydrates",
        data: Carbohydrates1,
        lineTension: 0, 
        fill: true 
      }
    ]
  }
});
                      }
                      });
      }
     
      
      





function piechart(changes){


  var username = localStorage.getItem("username");
const today1 = new Date()
var date = today1.getMonth() +1
var year = today1.getFullYear()
console.log(year)
var pieData = []
$.ajax({
    url:"server/getnultrition.php",
    data: {
        "username": username,
        "date": date,
        "year": year
    },
    type:"POST",
    crossDomain:true,
    
    success:function(msg){
      var TotalCalories = 0
        var TotalProtein = 0
        var TotalCarb = 0
        
        msg = JSON.parse(msg)                    
        if (changes == "calories"){
          document.getElementById("oilChart").style.display = "block";
          document.getElementById("oilChart2").style.display = "none";
          document.getElementById("oilChart1").style.display = "none";
          for (let i = 0; i < msg.length; i++){
          var eachNultrition = JSON.parse(msg[i].description)
          TotalCalories += parseFloat(eachNultrition.Calories)
          // TotalProtein += parseFloat(eachNultrition.Protein)
          // TotalCarb += parseFloat(eachNultrition.Carbohydrates)

        }
        pieData.push(TotalCalories)
        var CalBurn = 0
                    $.ajax({
                        url:"server/getCaloriesBurn.php",
                        data: {
                            "username": username,
                            "date": date,
                            "year": year
                        },
                        type:"POST",
                        crossDomain:true,
                        
                        success:function(response){
                         console.log(JSON.parse(response))
                         response = JSON.parse(response)
                          if (response.length == 0){
                            pieData.push(0)
                        }
                        else{
                          CalBurn = 0
                          for (let i = 0; i < response.length; i++){
                                //var eachNultrition = JSON.parse(response[i].caloriesBurned)
                                CalBurn += parseFloat(response[i].caloriesBurned)
                                }
                                pieData.push(CalBurn)
                        }
                        console.log(pieData)
        var oilCanvas = document.getElementById("oilChart");

var oilData = {
    labels: [
        "Calories",
        "Calories Burned"
    ],
    datasets: [
        {
            data: pieData,
            backgroundColor: [
                "#FF6384",
                "#84FF63"

            ]
        }]
};

var pieChart = new Chart(oilCanvas, {
  type: 'pie',
  data: oilData
});
                      }
                      })




        }

        else if( changes == "carbs" ){
          document.getElementById("oilChart").style.display = "none";
          document.getElementById("oilChart2").style.display = "none";
          document.getElementById("oilChart1").style.display = "block";
          
          var TotalCarb = 0
          for (let i = 0; i < msg.length; i++){
          var eachNultrition = JSON.parse(msg[i].description)
          //TotalCalories += parseFloat(eachNultrition.Calories)
          // TotalProtein += parseFloat(eachNultrition.Protein)
          TotalCarb += parseFloat(eachNultrition.Carbohydrates)

        }
        pieData.push(TotalCarb)
        console.log(document.getElementById("recoCarbs").value)
        pieData.push(document.getElementById("recoCarbs").value * 30)
                    
                       
                        console.log(pieData)
        var oilCanvas = document.getElementById("oilChart1");

                    var oilData = {
                        labels: [
                            "Carbs intake",
                            "Recommended Carbs"
                        ],
                        datasets: [
                            {
                                data: pieData,
                                backgroundColor: [
                                    "#FF6384",
                                    "#84FF63"

                                ]
                            }]
                    };

                    var pieChart = new Chart(oilCanvas, {
                      type: 'pie',
                      data: oilData
                    });
                                          }




          else if( changes == "protein" ){
            document.getElementById("oilChart").style.display = "none";
          document.getElementById("oilChart2").style.display = "block";
          document.getElementById("oilChart1").style.display = "none";
          var TotalProtein = 0
          for (let i = 0; i < msg.length; i++){
          var eachNultrition = JSON.parse(msg[i].description)
          //TotalCalories += parseFloat(eachNultrition.Calories)
          TotalProtein += parseFloat(eachNultrition.Protein)
          //TotalCarb += parseFloat(eachNultrition.Carbohydrates)

        }
        pieData.push(TotalProtein)
        console.log(document.getElementById("recoProt").value)
        pieData.push(document.getElementById("recoProt").value * 30)
                    
                       
                        console.log(pieData)
        var oilCanvas = document.getElementById("oilChart2");

                    var oilData = {
                        labels: [
                            "protein intake",
                            "Recommended protein"
                        ],
                        datasets: [
                            {
                                data: pieData,
                                backgroundColor: [
                                    "#FF6384",
                                    "#84FF63"

                                ]
                            }]
                    };

                    var pieChart = new Chart(oilCanvas, {
                      type: 'pie',
                      data: oilData
                    });
                                          }





        
    }
  });



}
piechart("calories")


    </script>
   
  
     <!-- Vendor JS Files -->
     <!-- <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script> -->
     <!-- <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
     <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
     <script src="assets/vendor/php-email-form/validate.js"></script>
     <script src="assets/vendor/swiper/swiper-bundle.min.js"></script> -->
   
     <!-- Template Main JS File -->
     <script src='style.js'></script>
     <script src="assets/js/main.js"></script> 
    



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>   -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/air-datepicker/2.2.3/js/datepicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/air-datepicker/2.2.3/js/i18n/datepicker.en.js"></script>

    

</body>
</html>